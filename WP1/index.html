<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Smart Door</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/1.11.8/semantic.min.css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/1.11.8/semantic.min.js"></script>
  </head>
  <body>

    <h1 style="margin:20px">Smart Door Owner Portal</h1>

    <script type="text/javascript" src="./apiGateway-js-sdk/lib/axios/dist/axios.standalone.js"></script>
    <script type="text/javascript" src="./apiGateway-js-sdk/lib/CryptoJS/rollups/hmac-sha256.js"></script>
    <script type="text/javascript" src="./apiGateway-js-sdk/lib/CryptoJS/rollups/sha256.js"></script>
    <script type="text/javascript" src="./apiGateway-js-sdk/lib/CryptoJS/components/hmac.js"></script>
    <script type="text/javascript" src="./apiGateway-js-sdk/lib/CryptoJS/components/enc-base64.js"></script>
    <script type="text/javascript" src="./apiGateway-js-sdk/lib/url-template/url-template.js"></script>
    <script type="text/javascript" src="./apiGateway-js-sdk/lib/apiGatewayCore/sigV4Client.js"></script>
    <script type="text/javascript" src="./apiGateway-js-sdk/lib/apiGatewayCore/apiGatewayClient.js"></script>
    <script type="text/javascript" src="./apiGateway-js-sdk/lib/apiGatewayCore/simpleHttpClient.js"></script>
    <script type="text/javascript" src="./apiGateway-js-sdk/lib/apiGatewayCore/utils.js"></script>
    <script type="text/javascript" src="./apiGateway-js-sdk/apigClient.js"></script>



    <div class="botui-app-container" id="bot_frontend" style="margin:20px">
      <bot-ui>
        <form class="ui form">
          <div class="field">
            <label>Name</label>
            <input type="text" name="name" placeholder="First Name">
          </div>
          <div class="field">
            <label>Phone Number</label>
            <input type="text" name="phone" placeholder="Phone Number">
          </div>
        </form>
        <button class="ui button" onclick="onsub()" style="margin:20px">Submit</button>
        <div class="ignored info ui message" id="output"></div>
      </bot-ui>
    </div>
    

    <script src="https://cdn.jsdelivr.net/vue/latest/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/botui/build/botui.js"></script>
    <script>
    
        function getUrlVars() {
            var vars = {};
            var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
                vars[key] = value;
                });
            return vars;
        }
            
        function onsub() {
          
          
          let name = "";
          for (var element of document.getElementsByName("name").values()){
            name = element.value;          
          }
          
          let phone = "";
          for (var element of document.getElementsByName("phone").values()){
            phone = element.value;          
          }
          

          
          let photo = getUrlVars()["filename"]
          let bucket = getUrlVars()["bucket"]
          
          var apigClient = apigClientFactory.newClient();
          apigClient.smartDoorPost(params={}, body={bucket:bucket, photo:photo, name:name, phone:phone}, additionalParams={}).then(function(result){
            console.log(result)
            
            if(result["status"] != 200 || "errorMessage" in result["data"]){
              document.getElementById("output").innerHTML = "REQUEST FAILED. PLEASE CONTACT SYSTEM ADMINISTRATOR"; 
            }else{
              document.getElementById("output").innerHTML = "SUCCESS. NOTIFIED USER";
            }
          });
          
        }

    </script>
  </body>
</html>
